# Zotero PDF2ZH - å¸¸è§é—®é¢˜ä¸æ’æŸ¥æŒ‡å—

æœ¬æŒ‡å—æ—¨åœ¨å¸®åŠ©æ‚¨è§£å†³åœ¨ä½¿ç”¨ Zotero PDF2ZH æ’ä»¶æ—¶å¯èƒ½é‡åˆ°çš„å¸¸è§é—®é¢˜ã€‚

**ä¸è¦åœ¨ç½®é¡¶ Issue ä¸‹æé—®**ï¼šè¯·ä¸ºæ¯ä¸ªæ–°é—®é¢˜å•ç‹¬å¼€ä¸€ä¸ª Issueã€‚æœ¬issueä¸‹ä¸å›ç­”é—®é¢˜ã€‚

## âš ï¸ æé—®å‰å¿…è¯»

åœ¨æäº¤é—®é¢˜ä¹‹å‰ï¼Œè¯·åŠ¡å¿…éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. **æ›´æ–°è‡³æœ€æ–°ç‰ˆæœ¬**ï¼šç¡®ä¿æ‚¨çš„ Zotero PDF2ZH æ’ä»¶å’Œç›¸å…³è„šæœ¬å·²æ›´æ–°åˆ° **v2.4.3** æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

2. **æŸ¥é˜…æ–‡æ¡£ä¸ç°æœ‰é—®é¢˜**ï¼š
 - ä»”ç»†é˜…è¯»æœ¬ä»“åº“çš„ [å®‰è£…æŒ‡å—](https://github.com/guaguastandup/zotero-pdf2zh)ã€‚
 - åœ¨ [Issue åŒº](https://github.com/guaguastandup/zotero-pdf2zh/issues%3Fq%3Dis%3Aissue) æœç´¢ï¼ŒåŒ…æ‹¬å·²å…³é—­çš„ Issueï¼Œçœ‹æ˜¯å¦æœ‰ç±»ä¼¼é—®é¢˜ã€‚

3. **å–„ç”¨ AI å·¥å…·**ï¼šå¯¹äºâ€œè™šæ‹Ÿç¯å¢ƒé—®é¢˜ã€xxxä¸‹è½½/å®‰è£…å¤±è´¥ã€æœ¬åœ°æƒé™é—®é¢˜ã€ç«¯å£å¼€å¯æƒé™ã€ä¸ç†Ÿæ‚‰ Pythonâ€ç­‰åŸºç¡€é—®é¢˜ï¼Œè¯·ä¼˜å…ˆä½¿ç”¨ AI å·¥å…·å¯»æ±‚è§£å†³æ–¹æ¡ˆã€‚

4. **æä¾›å®Œæ•´é”™è¯¯æˆªå›¾**ï¼šæé—®æ—¶ï¼Œè¯·åŠ¡å¿…ä¸Šä¼  **Zotero ç•Œé¢å¼¹å‡ºçš„é”™è¯¯çª—å£** å’Œ **æ‰§è¡Œ `server.py` æ–‡ä»¶çš„ç»ˆç«¯æŠ¥é”™æˆªå›¾**ã€‚æœªèƒ½æä¾›æˆªå›¾çš„é—®é¢˜å°†ç›´æ¥å…³é—­ä¸”ä¸äºˆå›å¤ï¼Œæ„Ÿè°¢ç†è§£ğŸ’—

5. **PDF2zh ä¾èµ–åŒ…ç‰ˆæœ¬æ£€æŸ¥**:
    - Python ç‰ˆæœ¬: `3.10 <= python <= 3.12`
    - PDF2zh ç‰ˆæœ¬: `pdf2zh >= 1.9.6`
    - pdfminer.six ç‰ˆæœ¬: `pdfminer.six == 20250416`

6. **å®Œæˆæµ‹è¯•**: å‡†å¤‡ä¸€ä¸ª PDF æ–‡ä»¶ (ä¾‹å¦‚ `xxx.pdf`)ï¼Œåœ¨ç»ˆç«¯è¿è¡Œ `pdf2zh xxx.pdf --service bing`ï¼Œç­‰å¾…ç¿»è¯‘å®Œæˆã€‚

7. **æ£€æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼**ï¼šjsonæ–‡ä»¶çš„æ ¼å¼è¦æ±‚æ¯”è¾ƒä¸¥æ ¼ã€‚
    - ä¸å…è®¸æ³¨é‡Šã€‚
    - é€—å·å¿…é¡»æ­£ç¡®ã€‚
    - Windows è·¯å¾„ä¸­çš„ `\` ç¬¦å·è¯·æ”¹ä¸º `\\`ã€‚
    - JSON æ–‡ä»¶**ä¸èƒ½ä¸ºç©º**ï¼Œå³ä½¿ä¸é…ç½®ä¹Ÿéœ€å¡«å…¥ `{}` æˆ– README ä¸­çš„æ¨¡æ¿å†…å®¹ã€‚

---

## å¸¸è§é”™è¯¯æ±‡æ€»

### ã€PDF2ZH å®‰è£…/ç¿»è¯‘æ•ˆæœã€‘é—®é¢˜
- **ç¿»è¯‘æ•ˆæœä¸ä½³/å†…å®¹æ¼ç¿»**ï¼šè¿™äº›é—®é¢˜**ä¸å±äºæœ¬ä»“åº“å¼€å‘èŒƒå›´**ã€‚è¯·å‰å¾€ [PDF2zh ä»“åº“ Issue åŒº](https://github.com/Byaidu/PDFMathTranslate/issues) æé—®ã€‚
- **[ç¿»è¯‘é‡å½±]((https://github.com/guaguastandup/zotero-pdf2zh/issues/63#issuecomment-2735247805))**ï¼š
 - åŸå› ï¼š`pdf2zh` **1.x ç‰ˆæœ¬ä¸æ”¯æŒ OCR**ã€‚
 - è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ `pdf2zh_next` ç‰ˆæœ¬å¹¶å¼€å¯ OCR æ¨¡å¼ã€‚

### ã€ç½‘ç»œè¿æ¥ã€‘é—®é¢˜
- **æŠ¥é”™ä¿¡æ¯**: `NetworkError when attempting to fetch resource` / `403 Forbidden`
- **ç¡®è®¤è„šæœ¬æ˜¯å¦æ­£åœ¨è¿è¡Œ**ï¼šæ£€æŸ¥ `python server.py 8888` å‘½ä»¤æ˜¯å¦æ­£åœ¨æ‰§è¡Œã€‚
- **æ£€æŸ¥æ’ä»¶ä¸è„šæœ¬ç«¯å£ä¸€è‡´æ€§**ï¼šç¡®ä¿ Zotero æ’ä»¶ä¸­ Python Server IP (å¦‚ `http://localhost:8888`) ä¸ `server.py` è„šæœ¬çš„ç«¯å£ä¸€è‡´ (ä¾‹å¦‚ `8888`)ã€‚
- **æ£€æŸ¥æœ¬åœ°ç«¯å£**ï¼šç¡®è®¤ç«¯å£æœªè¢«é˜²ç«å¢™å…³é—­æˆ–è¢«å…¶ä»–ç¨‹åºå ç”¨ã€‚
- **å°è¯• `curl` æµ‹è¯•**ï¼šåœ¨æ–°ç»ˆç«¯ä¸­è¾“å…¥ `curl http://localhost:8888/cut`ï¼Œè§‚å¯Ÿ `server.py` æ‰§è¡Œç»ˆç«¯æ˜¯å¦æ”¶åˆ°è¯¥ç½‘ç»œè¯·æ±‚ã€‚
- æˆåŠŸè®¿é—®ç¤ºæ„å›¾ï¼ˆå·¦å›¾ä¸­serveræ˜¾ç¤ºæ”¶åˆ°äº†ç½‘ç»œè¯·æ±‚ï¼‰ï¼š![Image](https://github.com/user-attachments/assets/8ae1ac76-5ac3-441d-899d-cbb131d26797)

### ã€ç¿»è¯‘å¤±è´¥ã€‘é—®é¢˜

- **ä¾èµ–åŒ…ç‰ˆæœ¬**ï¼šå‚è€ƒè¿è¡Œæ¡ä»¶ä¸€ï¼Œç¡®ä¿ä¾èµ–åŒ…ç‰ˆæœ¬æ­£ç¡®ã€‚
- **ç”Ÿæˆç¿»è¯‘ PDF å¤±è´¥**ï¼šå¦‚æœåœ¨ç¿»è¯‘è¿‡ç¨‹æ­£å¸¸ä½†ç”Ÿæˆ PDF å¤±è´¥ï¼Œè¯·åœ¨ Zotero æ’ä»¶é…ç½®ä¸­å‹¾é€‰ "**è·³è¿‡å­—ä½“å­é›†åŒ–**" é€‰é¡¹ï¼Œç„¶åé‡è¯•ã€‚
- **åˆ‡æ¢ç¿»è¯‘å¼•æ“åå¼‚å¸¸**ï¼šè¿™é€šå¸¸æ˜¯ç”±äºæ‚¨è®¾ç½®çš„ç¿»è¯‘æœåŠ¡é…ç½®é”™è¯¯ï¼Œæˆ–æœåŠ¡å› è¯·æ±‚è¿‡å¤š/API Key é”™è¯¯/URL é”™è¯¯/ç”¨é‡ä¸è¶³ç­‰åŸå› æ‹’ç»æœåŠ¡ã€‚
- **Bing æœåŠ¡å¼‚å¸¸**ï¼šå¾ˆå¯èƒ½æ˜¯è¯·æ±‚è¿‡å¤šå¯¼è‡´ Bing æœåŠ¡æ‹’ç»ã€‚è¯·è°ƒå°è¿›ç¨‹æ•°ï¼Œå¹¶ç­‰å¾…ä¸€æ®µæ—¶é—´åå†å°è¯•ã€‚

### ã€Value Errorã€‘é—®é¢˜

- é‡åˆ°æ­¤ç±»é”™è¯¯æ—¶ï¼Œè¯·åœ¨ Zotero æ’ä»¶é…ç½®é€‰é¡¹ä¸­å¼€å¯ "**è·³è¿‡å­—ä½“å­é›†åŒ–**"ã€‚
- **æ³¨æ„**ï¼šè·³è¿‡å­—ä½“å­é›†åŒ–ä¼šä½¿ç”Ÿæˆçš„ PDF æ–‡ä»¶å˜å¤§ï¼Œä½¿ç”¨åå»ºè®®å…³é—­æ­¤é€‰é¡¹ã€‚

<img width="678" height="312" alt="Image" src="https://github.com/user-attachments/assets/5f00dab5-99f1-473d-bef8-0792cfde72d4" />

### ã€ä¸‹è½½å¤±è´¥ã€‘é—®é¢˜
- `pdf2zh` éœ€è¦ä» `huggingface.co` ä¸‹è½½ ONNX æ¨¡å‹ã€‚å¦‚æœæ— æ³•è¿æ¥ï¼Œè¯·è®¾ç½® Hugging Face å›½å†…é•œåƒã€‚
- **å‚è€ƒé“¾æ¥**ï¼šhttps://zhuanlan.zhihu.com/p/684178533 (è¯·ä½¿ç”¨å…¶ä¸­çš„â€œè®¾ç½®ç¯å¢ƒå˜é‡â€æ–¹æ³•)ã€‚

### ã€æ‰¾ä¸åˆ°æ–‡ä»¶/è™šæ‹Ÿç¯å¢ƒã€‘é—®é¢˜

- **æŠ¥é”™ä¿¡æ¯**: `WinError: æ‰¾ä¸åˆ°æ–‡ä»¶`
- **æ£€æŸ¥è¿è¡Œæ¡ä»¶ä¸€**ï¼šç¡®ä¿ä¾èµ–åŒ…ç‰ˆæœ¬æ­£ç¡®ï¼Œå¹¶ä¸”æ‚¨å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ `pdf2zh xxx.pdf --service bing` å®Œæˆç¿»è¯‘ã€‚
- **æ£€æŸ¥ç¿»è¯‘ä¸´æ—¶è·¯å¾„**ï¼šé»˜è®¤è·¯å¾„ä¸º `./translated/` (ä¸ `server.py` åŒçº§ç›®å½•)ã€‚å¦‚æœæœªåˆ›å»ºï¼Œè¯·æ‰‹åŠ¨åˆ›å»ºã€‚

### ã€åŒæ å¯¹ç…§æ¨¡å¼æ˜¾ç¤º PDF ä¸å…¨ã€‘
- **PDF ä¸ºå•æ æ–‡ä»¶**ï¼šç¿»è¯‘é€‰é¡¹è¯·é€‰æ‹© "**åŒæ å¯¹ç…§ï¼ˆå•æ ï¼‰**"ã€‚
- **PDF ä¸ºåŒæ æ–‡ä»¶**ï¼š
    - è‹¥å¸Œæœ›å·¦ä¾§è‹±æ–‡ã€å³ä¾§ä¸­æ–‡ (ä¸¤åˆ—å½¢å¼)ï¼Œè¯·é€‰æ‹© "**åŒæ å¯¹ç…§ï¼ˆåŒæ ï¼‰**"ã€‚
    - è‹¥å¸Œæœ›å·¦ä¾§åŒæ è‹±æ–‡ã€å³ä¾§åŒæ ä¸­æ–‡ (å››åˆ—å½¢å¼)ï¼Œè¯·é€‰æ‹© "**åŒæ å¯¹ç…§ï¼ˆå•æ ï¼‰**"ã€‚

- **PDF æ˜¾ç¤ºä¸å…¨ (åˆ‡å‰²ä¸¤ä¾§ç•™ç™½å¯¼è‡´)**ï¼šæœ¬æ’ä»¶é»˜è®¤ä¼šåˆ‡å‰²ä¸¤ä¾§ç•™ç™½ã€‚å¦‚æœåˆ‡å‰²åæ˜¾ç¤ºä¸å…¨ï¼Œè¯·å°† `server.py` ä¸­çš„ `split_pdf` å‡½æ•°æ›¿æ¢ä¸ºä»¥ä¸‹ä»£ç ï¼š

```python
# å·¥å…·å‡½æ•°, ç”¨äºåˆ‡å‰²åŒæ pdfæ–‡ä»¶
def split_pdf(self, input_pdf, output_pdf, compare=False, babeldoc=False):
    writer = PdfWriter()
    if ('dual' in input_pdf or compare == True) and babeldoc == False:
        readers = [PdfReader(input_pdf) for _ in range(4)]
        for i in range(0, len(readers[0].pages), 2):
            original_media_box = readers[0].pages[i].mediabox
            width = original_media_box.width
            height = original_media_box.height
            left_page_1 = readers[0].pages[i]
            offset = 0
            ratio = 1
            for box in ['mediabox', 'cropbox', 'bleedbox', 'trimbox', 'artbox']:
                setattr(left_page_1, box, RectangleObject((offset, 0, width/2+offset/ratio, height)))
            left_page_2 = readers[1].pages[i+1]
            for box in ['mediabox', 'cropbox', 'bleedbox', 'trimbox', 'artbox']:
                setattr(left_page_2, box, RectangleObject((offset, 0, width/2+offset/ratio, height)))
            right_page_1 = readers[2].pages[i]
            for box in ['mediabox', 'cropbox', 'bleedbox', 'trimbox', 'artbox']:
                setattr(right_page_1, box, RectangleObject((width/2-offset/ratio, 0, width-offset, height)))
            right_page_2 = readers[3].pages[i+1]
            for box in ['mediabox', 'cropbox', 'bleedbox', 'trimbox', 'artbox']:
                setattr(right_page_2, box, RectangleObject((width/2-offset/ratio, 0, width-offset, height)))
            if compare == True:
                blank_page_1 = writer.add_blank_page(width, height)
                blank_page_1.merge_transformed_page(left_page_1, (1, 0, 0, 1, 0, 0))
                blank_page_1.merge_transformed_page(left_page_2, (1, 0, 0, 1, width / 2, 0))
                blank_page_2 = writer.add_blank_page(width, height)
                blank_page_2.merge_transformed_page(right_page_1, (1, 0, 0, 1, -width / 2, 0))
                blank_page_2.merge_transformed_page(right_page_2, (1, 0, 0, 1, 0, 0))
            else:
                writer.add_page(left_page_1)
                writer.add_page(left_page_2)
                writer.add_page(right_page_1)
                writer.add_page(right_page_2)
    else: 
        readers = [PdfReader(input_pdf) for _ in range(2)]
        for i in range(len(readers[0].pages)):
            page = readers[0].pages[i]
            original_media_box = page.mediabox
            width = original_media_box.width
            height = original_media_box.height
            w_offset = 0
            w_ratio = 1
            h_offset = 0
            left_page = readers[0].pages[i]
            left_page.mediabox = RectangleObject((w_offset, h_offset, width/2+w_offset/w_ratio, height-h_offset))
            right_page = readers[1].pages[i]
            right_page.mediabox = RectangleObject((width/2-w_offset/w_ratio, h_offset, width-w_offset, height-h_offset))
            writer.add_page(left_page)
            writer.add_page(right_page)
    with open(output_pdf, "wb") as output_file:
        writer.write(output_file)
```